name: TFSec
on:
  push:
    paths:
      - "terraform/"
      - ".github/workflows/tfsec.yml"
  workflow_dispatch:

jobs:
  # FIXME does not upload
  # TODO see also https://github.com/aquasecurity/tfsec-sarif-action/pull/25
  # TODO pass or fail build based on result
  tfsec:
    name: tfsec sarif report
    runs-on: ubuntu-latest

    steps:
      - name: Clone repo
        uses: actions/checkout@main

      - name: TFSec Sarif
        uses: aquasecurity/tfsec-sarif-action@master
        with:
          sarif_file: tfsec.sarif
          full_repo_scan: true

      - name: Upload SARIF file
        uses: github/codeql-action/upload-sarif@v1
        with:
          # Path to SARIF file relative to the root of the repository
          sarif_file: tfsec.sarif    
